<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
        />
        <!-- link to the SqPaymentForm library -->
        <script
            type="text/javascript"
            src="https://js.squareupsandbox.com/v2/paymentform"
        ></script>
        <!-- link to the local custom styles for SqPaymentForm -->
        <link
            rel="stylesheet"
            type="text/css"
            href="mysqpaymentform.css"
        />
        <title>Square Sandbox</title>
    </head>
    <body>
        <div id="form-container">
            <!-- Multiple inputs -->
            <!-- <div id="sq-card-number"></div>
            <div class="third" id="sq-expiration-date"></div>
            <div class="third" id="sq-cvv"></div>
            <div class="third" id="sq-postal-code"></div> -->

            <!-- Single input -->
            <div id="sq-card"></div>

            <button
                id="sq-creditcard"
                class="button-credit-card"
                onclick="onGetCardNonce(event)"
            >
                Pay $1.00
            </button>
        </div>
        <!-- end #form-container -->
        <script type="text/javascript">
            // Create and initialize a payment form object
            const paymentForm = new SqPaymentForm({
                // Initialize the payment form elements

                applicationId:
                    "sandbox-sq0idb-lIROqsYiiHch6rR8NSOqmw",
               
                // Multiple inputs    
                // inputClass: "sq-input",

                autoBuild: false,
                // Customize the CSS for SqPaymentForm iframe elements
                // Multiple inputs
                // inputStyles: [
                //     {
                //         fontSize: "16px",
                //         lineHeight: "24px",
                //         padding: "16px",
                //         placeholderColor: "#a0a0a0",
                //         backgroundColor: "transparent",
                //     },
                // ],
                // Initialize the credit card placeholders
                // Multiple inputs
                // cardNumber: {
                //     elementId: "sq-card-number",
                //     placeholder: "Card Number",
                // },
                // cvv: {
                //     elementId: "sq-cvv",
                //     placeholder: "CVV",
                // },
                // expirationDate: {
                //     elementId: "sq-expiration-date",
                //     placeholder: "MM/YY",
                // },
                // postalCode: {
                //     elementId: "sq-postal-code",
                //     placeholder: "Postal",
                // },

                // Single Input
                card: {
                  elementId: 'sq-card',
           },
                // SqPaymentForm callback functions
                callbacks: {
                    /*
                     * callback function: cardNonceResponseReceived
                     * Triggered when: SqPaymentForm completes a card nonce request
                     */
                    cardNonceResponseReceived: function (
                        errors,
                        nonce,
                        cardData
                    ) {
                        if (errors) {
                            // Log errors from nonce generation to the browser developer console.
                            console.error("Encountered errors:");
                            errors.forEach(function (error) {
                                console.error("  " + error.message);
                            });
                            alert(
                                "Encountered errors, check browser developer console for more details"
                            );
                            return;
                        }
                        fetch("process-payment", {
                            method: "POST",
                            headers: {
                                Accept: "application/json",
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                nonce: nonce,
                            }),
                        })
                            .catch((err) => {
                                alert("Network error: " + err);
                            })
                            .then((response) => {
                                if (!response.ok) {
                                    return response
                                        .json()
                                        .then((errorInfo) =>
                                            Promise.reject(errorInfo)
                                        ); //UPDATE HERE
                                }
                                return response.json(); //UPDATE HERE
                            })
                            .then((data) => {
                                console.log(data); //UPDATE HERE
                                alert(
                                    "Payment complete successfully!\nCheck browser developer console for more details"
                                );
                            })
                            .catch((err) => {
                                console.error(err);
                                alert(
                                    "Payment failed to complete!\nCheck browser developer console for more details"
                                );
                            });
                    },
                },
            });
            paymentForm.build();

            // onGetCardNonce is triggered when the "Pay $1.00" button is clicked
            function onGetCardNonce(event) {
                // Don't submit the form until SqPaymentForm returns with a nonce
                event.preventDefault();
                // Request a nonce from the SqPaymentForm object
                paymentForm.requestCardNonce();
            }
        </script>
    </body>
</html>
